#apiVersion: batch/v1
#kind: CronJob
#metadata:
#  labels:
#    app: {{ .Release.Name }}-transferlogs
#  name: {{ .Release.Name }}-transferlogs
#  namespace: {{ .Release.Namespace }}
#spec:
#  concurrencyPolicy: {{ .Values.transferLogs.concurrencyPolicy }}
#  failedJobsHistoryLimit: {{ .Values.transferLogs.failedJobsHistoryLimit }}
#  jobTemplate:
#    spec:
#      template:
#        metadata:
#          annotations:
#            cluster-autoscaler.kubernetes.io/safe-to-evict: "false"
#          labels:
#            app: {{ .Release.Name }}-transferlogs
#            release: transferlogs
#        spec:
#          containers:
#            - env:
#                - name: NUM_THREADS
#                  valueFrom:
#                    secretKeyRef:
#                      key: NUM_THREADS
#                      name: transferlogs-configs
#                - name: PHASE_SELECTOR
#                  valueFrom:
#                    secretKeyRef:
#                      key: PHASE_SELECTOR
#                      name: transferlogs-configs
#              image: {{ .Values.transferLogs.image }}
#              imagePullPolicy: {{ .Values.transferLogs.imagePullPolicy }}
#              name: transferlogs
#              resources:
#                limits:
#                  cpu: {{ .Values.transferLogs.resources.limits.cpu }}
#                  memory: {{ .Values.transferLogs.resources.limits.memory }}
#              volumeMounts:
#                - mountPath: /etc/credentialfiles/
#                  name: transferlogs-file-credentials-vol
#                - mountPath: /var/log/dumps
#                  name: dump-vol
#                - mountPath: /var/log/backup-log/
#                  name: logs-vol-azure-files
#          restartPolicy: {{ .Values.transferLogs.restartPolicy }}
#          tolerations:
#            - effect: {{ .Values.global.tolerations.effect }}
#              key: {{ .Values.global.tolerations.key }}
#              operator: {{ .Values.global.tolerations.operator }}
#              value: {{ .Values.global.tolerations.value }}
#          volumes:
#            - name: transferlogs-file-credentials-vol
#              secret:
#                defaultMode: 420
#                secretName: transferlogs-file-credentials
#            - hostPath:
#                path: /var/log/dumps/transferlogs
#                type: DirectoryOrCreate
#              name: dump-vol
#            - name: logs-vol-azure-files
#              persistentVolumeClaim:
#                claimName: {{ .Release.Name }}-pvc
#  schedule: {{ .Values.transferLogs.schedule }}
#  successfulJobsHistoryLimit: {{ .Values.transferLogs.successfulJobsHistoryLimit }}
#  suspend: {{ .Values.transferLogs.suspend }}
#
#---
#apiVersion: v1
#kind: Secret
#metadata:
#  name: transferlogs-file-credentials
#  namespace: default
#type: Opaque
#
#---
#apiVersion: v1
#kind: Secret
#metadata:
#  name: transferlogs-configs
#type: Opaque
#data:
#  {{- range $index, $value := .Values.transferLogs.configurations }}
#    {{ $index }}: {{ $value | default "" | b64enc | default ("" | quote) }}
#  {{- end }}